<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>API explorer</title>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/pearForm.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/fangge-style.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/pear-tree/dtree.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/nav.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/apiexplore.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/code.css}"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>
<body>

<input type="hidden" name="resource" id="resource" value="root">
<input type="hidden" name="name" id="apiName">
<input id="documentId" name="documentId" th:value="${documentId}" type="hidden"/>

<input type="hidden" name="projectId" id="projectId" th:value="${projectId}"/>
<div class="layui-fluid" style="margin-top: 10px">
    <div class="layui-row">
        <div class="layui-col-md8">
            <form class="layui-form layui-form-pane" action="" id="request_form">
                <fieldset class="layui-elem-field site-demo-button" style="margin-top: 10px;">
                    <div class="layui-form-item">
                        <div class="layui-input-inline">
                            <select id="method" name="method" lay-verify="method">
                                <option value="NON" disabled>请选择请求方式</option>
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                                <option value="PATCH">PATCH</option>
                                <option value="OPTION">OPTION</option>
                            </select>
                        </div>
                        <div class="layui-input-inline">
                            <input id="url" type="text" name="url"
                                   placeholder="127.0.0.1:8080/springboot/{resource}/{id}"
                                   lay-verify="url" autocomplete="off"
                                   style="width: 220%"
                                   class="layui-input">
                        </div>
                        <button class="layui-btn" style="margin-left: 23%;float: left" lay-submit lay-filter="execute">
                            <i class="layui-icon layui-icon-triangle-r" style="font-size: 17px; color: white;"></i>调试
                        </button>
                        <button class="layui-btn" lay-submit lay-filter="save">
                            <i class="layui-icon layui-icon-email" style="font-size: 18px; color: white;"></i> 保存
                        </button>
                    </div>
                </fieldset>

                <div class="layui-collapse group">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title layui-bg-red">REST路径参数</h2>
                        <div class="layui-colla-content" id="uri-fieldset">
                            <div class="layui-form-item" style="margin-top: 10px">
                                <div class="layui-inline">
                                    <button type="button" class="layui-btn layui-btn-primary"
                                            id="add_pathvar_field_btn">
                                        增加路径参数
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="layui-collapse group">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title layui-bg-orange">请求头</h2>
                        <div class="layui-colla-content" id="header-fieldset">
                            <div class="layui-form-item" style="margin-top: 10px">
                                <div class="layui-inline">
                                    <button type="button" class="layui-btn layui-btn-primary"
                                            id="add_request_header_field">
                                        增加请求头参数
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-collapse group">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title layui-bg-cyan">请求参数</h2>
                        <div class="layui-colla-content" id="body-fieldset">

                            <div class="layui-form-item" style="margin-top: 10px">
                                <div class="layui-inline">
                                    <button type="button" class="layui-btn layui-btn-primary"
                                            id="add_request_body_field">
                                        增加请求参数
                                    </button>

                                    <button type="button" class="layui-btn"
                                            id="convert_json_to_fields">
                                        JSON快速转换
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-collapse group">
                    <div class="layui-colla-item">
                        <h2 class="layui-colla-title layui-bg-black">期望响应参数</h2>
                        <div class="layui-colla-content" id="response-fieldset">

                            <div class="layui-form-item" style="margin-top: 10px">
                                <div class="layui-inline">
                                    <button type="button" class="layui-btn layui-btn-primary"
                                            id="add_response_body_field">
                                        增加响应参数
                                    </button>
                                    <button type="button" class="layui-btn"
                                            id="convert_response_json_fields">
                                        JSON快速转换
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="layui-col-md4">
            <div class="layui-row">
            </div>
            <div class="layui-row">
                <table id="testLogTable" lay-filter="testLogTable"></table>
            </div>
        </div>
    </div>
</div>

<div id="testMode" style="display: none">
    <form class="layui-form" action="">
        <div class="layui-form-item">
            <label class="layui-form-label">模式选择</label>
            <div class="layui-input-block">
                <input type="radio" name="executeMode" value="out" title="外网调试" checked>
                <input type="radio" name="executeMode" value="rpc" title="RPC远程调试">
            </div>
        </div>
    </form>
</div>

<div id="consolePage" class="layui-fluid" style="display: none;width: 400px">

</div>

<script th:src="@{/layui/layui.js}"></script>
<script th:src="@{/admin/js/jquery.js}"></script>
<script th:src="@{/admin/js/doc/content.js}"></script>
<script th:src="@{/admin/js/doc/response.js}"></script>
<script th:src="@{/admin/js/doc/urivar.js}"></script>
<script th:src="@{/admin/js/doc/header.js}"></script>
<script th:src="@{/admin/js/marked.min.js}" type="application/javascript" charset="UTF-8"></script>
<script th:src="@{/admin/js/util.js}"></script>
<script type="text/javascript" th:inline="javascript">
    $("#projectNav").addClass("layui-this");
    var msg;
    var globalExecuteResult = null;
    layui.config({
        base: '/restdoc/layui/lay/extends/'
    }).use(['layer',
        'form',
        'element',
        'jquery', 'table'], function () {

        var form = layui.form;
        var $ = layui.jquery;
        msg = layui.layer;
        var layer = layui.layer;
        var element = layui.element;
        var table = layui.table;
        var treeData = null;
        var documentId = $("#documentId").val();

        $.ajax({
            type: 'GET',
            url: '/restdoc/' + $("#projectId").val() + '/resource/tree?onlyResource=true',
            async: false,
            success: function (data) {
                if (data['code'] === "200") {
                    treeData = data['data'];
                } else {
                    layer.msg(data['message']);
                }
            },
            error: function () {
                layer.msg("网络异常")
            }
        });
        form.verify({
            url: function (value, item) {
                /*if (!new RegExp("^(http(s?)\\:\\/\\/)?[0-9a-zA-Z]([-.\\w]*[0-9a-zA-Z])*(:(0-9)*)*(\\/?)([a-zA-Z0-9\\-\\.\\?\\,\\'\\/\\\\\\+&amp;%$#_]*)?$").test(value)) {
                    return "URL格式不正确";
                }*/

                if (value === "") return "URL格式不正确";
            },
            type: function (value, item) {
                if (value === "NON")
                    return "请选择参数类型";
            }
            , pass: []
        });

        //第一个实例

        table.render({
            elem: '#testLogTable'
            , url: '/restdoc/document/' + documentId + '/httpapitestlog/page'
            , page: true
            , size: 'sm'
            , skin: 'nob'
            , limits: [50, 100]
            , totalRow: false
            , loading: true
            , title: '调试记录'
            , text: {
                none: '无调试记录'
            }
            , cols: [
                [
                    {
                        width: 80, field: '状态', title: 'Success', align: 'center', templet: function (res) {
                            if (res.success) {
                                return "<i class='layui-icon layui-icon-ok-circle' style='=font-size: 17px; color: #5FB878;'></i>"
                            } else {
                                return "<i class='layui-icon layui-icon-close-fill' style='=font-size: 17px; color: #FF5722;'></i>"
                            }
                        }
                    },
                    {field: 'testMode', title: 'Mode', align: 'center', width: 80},
                    {
                        field: 'createTime',
                        title: '时间',
                        align: 'center',
                        width: 160,
                        templet: '<label>{{formatTimestamp(d.createTime)}}</label>'
                    },
                    {field: 'testMode', title: 'Mode', align: 'center'}
                ]
            ]

        });

        $('#tableContent').click(function () {
            layer.open({
                type: 1,
                title: '选择目录',
                content: $('#sourceTreeDiv'),
                area: ['300px', '400px']
            });
        });

        $('#convert_json_to_fields').click(function (event) {
            layer.open({
                title: 'JSON快速转换',
                area: ['900px', '600px'],
                scrollbar: false,
                type: 2,
                content: '/restdoc/document/json/convert',
                closeBtn: 1,
                btn: ['转换JSON'],
                yes: function (index, layero) {
                    var res = window["layui-layer-iframe" + index].getJSONValue();
                    $.ajax({
                        type: 'POST',
                        dataType: 'JSON',
                        contentType: 'application/json;charset=utf-8',
                        url: '/restdoc/document/deProject',
                        data: res,
                        async: false,
                        success: function (data) {
                            if (data.code === '200') {
                                if (data.data.length >= 1) {
                                    clearRequestParamInput();

                                    for (let i = 0; i < data.data.length; i++) {
                                        addRequestParamInput();
                                    }

                                    var all_input_line = $("#body-fieldset").children(".multi-request-body");

                                    for (let i = 0; i < all_input_line.length; i++) {
                                        let line = all_input_line[i];
                                        $(line).find("input").each(function () {
                                            if (this.name === 'requestFieldPath') {
                                                this.value = data.data[i]['path']
                                            } else if (this.name === 'requestFieldValue') {
                                                this.value = data.data[i]['value']
                                            }
                                        });

                                        $($(line).find("select:first-child"))
                                            .find("option[value=" + data.data[i]['type'] + "]")
                                            .attr("selected", true);
                                    }
                                }
                                // 重新渲染页面
                                form.render();
                            } else {
                                layer.msg('JSON转换失败，错误信息:' + data.message)
                            }
                        },
                        error: function (data) {
                            layer.msg("JSON格式错误")
                        }
                    });
                    layer.close(index);
                }
            });
        });
        $('#convert_response_json_fields').click(function (event) {
            layer.open({
                title: 'JSON快速转换',
                area: ['900px', '600px'],
                scrollbar: false,
                type: 2,
                content: '/restdoc/document/json/convert',
                closeBtn: 1,
                btn: ['转换JSON'],
                yes: function (index, layero) {
                    var res = window["layui-layer-iframe" + index].getJSONValue();
                    completeExecuteCallback(JSON.parse(res));
                    layer.close(index);
                }
            });
        });
        $("#add_request_header_field").click(function (event) {
            $("#header-fieldset").append(oneheaderline);
            form.render();
        });

        function addRequestParamInput() {
            $("#body-fieldset").append(oneline);
        }

        function addResponseParamInput() {
            $("#response-fieldset").append(responseoneline);
        }

        function clearResponseParamInput() {
            var all_input_line = $("#response-fieldset").children(".one-response-body-line");
            var line_length = all_input_line.length;

            if (line_length > 0) {
                for (let i = 0; i < line_length; i++) {
                    var obj = all_input_line[i];
                    var parent = obj.parentNode;
                    parent.removeChild(obj)
                }
            }
        }

        function clearRequestParamInput() {
            var all_input_line = $("#body-fieldset").children(".multi-request-body");
            var line_length = all_input_line.length;

            if (line_length > 0) {
                for (let i = 0; i < line_length; i++) {
                    var obj = all_input_line[i];
                    var parent = obj.parentNode;
                    parent.removeChild(obj)
                }
            }
        }

        $("#add_request_body_field").click(function (event) {
            addRequestParamInput();
            form.render();
        });
        $("#add_response_body_field").click(function (event) {
            $("#response-fieldset").append(responseoneline);
            form.render();
        });
        $("#add_pathvar_field_btn").click(function (event) {
            $("#uri-fieldset").append(oneuriline);
            form.render();
        });

        form.on('submit(save)', function (data) {
            var projectId = $("#projectId").val();

            var map = getFormData(data.field);
            map['executeResult'] = globalExecuteResult;
            if (map['description'] != null) {

                map['description'] = easyeditor.content(map['description'])
            }
            var method;
            var did = $("#documentId").val();

            map["projectId"] = projectId;
            map["documentId"] = did;
            var isNewDoc = true;
            if (did === undefined || did === "") {
                method = "POST"
            } else {
                method = "PUT";
                isNewDoc = false;
            }

            if (isNewDoc) {
                layer.open({
                    type: 2,
                    title: '完善API基本信息',
                    area: ['700px', '500px'],
                    content: ['/restdoc/' + projectId + '/document/baseinfo/edit/view', 'no'],
                    btn: ['确定', '取消'],
                    yes: function (index, doc) {
                        var res = window["layui-layer-iframe" + index].getFormData();

                        map['name'] = res['name'];
                        map['resource'] = res['resource'];

                        $("#apiName").val(res['name']);
                        $("#resource").val(res['resource']);

                        $.ajax({
                            type: 'POST',
                            dataType: 'JSON',
                            contentType: 'application/json;charset=utf-8',
                            url: '/restdoc/document',
                            data: JSON.stringify(map),
                            async: false,
                            success: function (data) {
                                if (data['code'] === "200") {
                                    if (data['data'] != null) {
                                        var id = data['data'];
                                        $('#documentId').val(id);
                                        console.info(id);
                                        layer.msg("保存成功");
                                    } else {
                                        layer.msg("保存失败")
                                    }
                                } else {
                                    layer.msg(data['message'])
                                }
                            },
                            error: function () {
                                layer.msg("网络异常")
                            }
                        });
                        layer.close(index);
                    }
                });
            } else {
                map['name'] = $("#apiName").val();
                map['resource'] = $("#resource").val();

                $.ajax({
                    type: 'PUT',
                    dataType: 'JSON',
                    contentType: 'application/json;charset=utf-8',
                    url: '/restdoc/document',
                    data: JSON.stringify(map),
                    async: false,
                    success: function (data) {
                        if (data['code'] === "200") {
                            if (data['data'] != null) {
                                var id = data['data'];
                                $('#documentId').val(id);
                                layer.msg("保存成功");
                            } else {
                                layer.msg("保存失败")
                            }
                        } else {
                            layer.msg(data['message'])
                        }
                    },
                    error: function () {
                        layer.msg("网络异常")
                    }
                });
            }
            return false;
        });

        form.on('submit(execute)', function (data) {
            layer.open({
                type: 1,
                content: $('#testMode'),
                title: '调试模式选择',
                btn: ['确定', '取消'],
                area: ['300px', '200px'],
                yes: function (index, layero) {
                    if ("out" === $("input[name='executeMode']:checked").val()) {
                        publicNetExecute(data);
                    } else {
                        rpcExecute(data);
                    }
                    layer.close(index);
                }
            });
            return false;
        });

        function rpcExecute(data) {
            var map = getFormData(data.field);
            var executeResult = null;
            layer.open({
                type: 2,
                title: '请选择运行服务实例',
                content: '/restdoc/serviceClient/view/list',
                area: ['600px', '400px'],
                btn: ['确定', '取消'],
                yes: function (index, dom) {
                    var res = window["layui-layer-iframe" + index].getCheckData();
                    map["executeMode"] = "remoteAddress";
                    map["remoteAddress"] = res[0]['remoteAddress'];
                    map['projectId'] = $("#projectId").val();
                    map["documentId"] = $("#documentId").val();
                    $.ajax({
                        type: 'POST',
                        dataType: 'JSON',
                        contentType: 'application/json;charset=utf-8',
                        url: '/restdoc/httptask/submit',
                        data: JSON.stringify(map),
                        async: false,
                        success: function (data) {
                            if (data['code'] === "200") {
                                executeResult = data['data'];
                                layer.msg('执行成功')
                            } else {
                                layer.msg(data['message']);
                            }
                        },
                        error: function () {
                            layer.msg("网络异常")
                        }
                    });

                    if (executeResult != null) {
                        globalExecuteResult = executeResult;
                        var invocationResult = executeResult;
                        if (invocationResult != null) {
                            if (invocationResult['responseBody'] != null) {
                                openConsolePage(invocationResult)
                            }
                        }
                    }
                    layer.close(index)
                }
            });
        }

        function publicNetExecute(data) {
            var map = getFormData(data.field);
            var executeResult = null;

            if (!/^https?:\/\/.+/.test(map['url'])) {
                layer.msg("请填写完整的URL地址，缺少IP地址端口或者域名")
            } else {
                map['projectId'] = $("#projectId").val();
                map["documentId"] = $("#documentId").val();
                $.ajax({
                    type: 'POST',
                    dataType: 'JSON',
                    contentType: 'application/json;charset=utf-8',
                    url: '/restdoc/httptask/submit',
                    data: JSON.stringify(map),
                    async: false,
                    success: function (data) {
                        if (data['code'] === "200") {
                            if (data['data'] != null) {
                                executeResult = data['data'];
                                layer.msg('执行成功')
                            } else {
                                layer.msg("任务提交失败")
                            }
                        } else {
                            layer.msg(data['message'])
                        }

                    },
                    error: function () {
                        layer.msg("网络异常")
                    }
                });

                if (executeResult != null) {
                    globalExecuteResult = executeResult;
                    var invocationResult = executeResult;

                    if (invocationResult != null) {
                        if (invocationResult['responseBody'] != null) {
                            openConsolePage(invocationResult)
                        }
                    }
                }
            }
        }

        function completeExecuteCallback(body) {
            if (body != null) {
                $("#response-fieldset").addClass("layui-show");
                $.ajax({
                    type: 'POST',
                    dataType: 'JSON',
                    contentType: 'application/json;charset=utf-8',
                    url: '/restdoc/document/deProject',
                    data: JSON.stringify(body),
                    async: false,
                    success: function (data) {
                        if (data.code === '200') {
                            if (data.data.length >= 1) {
                                clearResponseParamInput();

                                for (let i = 0; i < data.data.length; i++) {
                                    addResponseParamInput();
                                }
                                var all_input_line = $("#response-fieldset").children(".one-response-body-line");
                                for (let i = 0; i < all_input_line.length; i++) {
                                    let line = all_input_line[i];
                                    $(line).find("input").each(function () {
                                        if (this.name === 'responseFieldPath') {
                                            this.value = data.data[i]['path']
                                        }
                                    });

                                    $($(line).find("select:first-child"))
                                        .find("option[value=" + data.data[i]['type'] + "]")
                                        .attr("selected", true);
                                }
                            }
                            // 重新渲染页面
                            form.render();
                        } else {
                            layer.msg('JSON转换失败，错误信息:' + data.message)
                        }
                    },
                    error: function (data) {
                        layer.msg("JSON格式错误")
                    }
                });
            }
            form.render();
            element.render('collapse');
        }

        function openConsolePage(data) {
            var start = "<div class='layui-collapse'>";
            var end = "</div>";

            // General
            start = start + "  <div class='layui-colla-item'><h2 class='layui-colla-title'>General</h2>" +
                "<div class='layui-colla-content layui-show'><strong>Status Code:&nbsp;&nbsp;&nbsp;</strong>" + data.status +
                "<br><strong>Request URL:&nbsp;&nbsp;&nbsp;</strong>" + data.invocation.url +
                "<br><strong>Request Method:&nbsp;&nbsp;&nbsp;</strong>" + data.invocation.method +
                "</div></div>";

            // RequestHeader
            var requestHeaderH5Text = "";
            if (data.invocation.requestHeaders != null) {
                for (const [key, value] of Object.entries(data.invocation.requestHeaders)) {
                    requestHeaderH5Text = requestHeaderH5Text + "<strong>" + key + "&nbsp;&nbsp;&nbsp;</strong>" + value + "<br>";
                }
                if (requestHeaderH5Text !== '') {
                    start = start + "  <div class='layui-colla-item'><h2 class='layui-colla-title'>Request Headers</h2>" +
                        "<div class='layui-colla-content'>" + requestHeaderH5Text + "</div></div>";
                }
            }

            if (data.invocation.uriVariable != null) {
                // URI var
                var uriVarH5Text = "";
                for (const [key, value] of Object.entries(data.invocation.uriVariable)) {
                    uriVarH5Text = uriVarH5Text + "<strong>" + key + "&nbsp;&nbsp;&nbsp;</strong>" + value + "<br>";
                }
                if (uriVarH5Text !== '') {
                    start = start + "  <div class='layui-colla-item'><h2 class='layui-colla-title'>URI Variable</h2>" +
                        "<div class='layui-colla-content'>" + uriVarH5Text + "</div></div>";
                }
            }


            // Query Param
            if (data.invocation.queryParam != null) {
                var queryParamH5Text = "";
                for (const [key, value] of Object.entries(data.invocation.queryParam)) {
                    queryParamH5Text = queryParamH5Text + "<strong>" + key + "&nbsp;&nbsp;&nbsp;</strong>" + value + "<br>";
                }
                if (queryParamH5Text !== '') {
                    start = start + "  <div class='layui-colla-item'><h2 class='layui-colla-title'>Query Param</h2>" +
                        "<div class='layui-colla-content'>" + queryParamH5Text + "</div></div>";
                }
            }
            // RequestBody
            if (data.invocation.requestBody != null) {
                var requestBodyH5Text = "";
                for (const [key, value] of Object.entries(data.invocation.requestBody)) {
                    requestBodyH5Text = requestBodyH5Text + "<strong>" + key + "&nbsp;&nbsp;&nbsp;</strong>" + value + "<br>";
                }
                if (requestBodyH5Text !== '') {
                    start = start + "  <div class='layui-colla-item'><h2 class='layui-colla-title'>Request Body</h2>" +
                        "<div class='layui-colla-content'>" + requestBodyH5Text + "</div></div>";
                }
            }

            // ResponseHeader
            var responseHeadersH5Text = "";
            if (data.responseHeaders != null) {
                for (const [key, value] of Object.entries(data.responseHeaders)) {
                    responseHeadersH5Text = responseHeadersH5Text + "<strong>" + key + "&nbsp;&nbsp;&nbsp;</strong>" + value + "<br>";
                }
            }
            start = start + "  <div class='layui-colla-item'><h2 class='layui-colla-title'>Response Headers</h2>" +
                "<div class='layui-colla-content'>" + responseHeadersH5Text + "</div></div>";

            // ResponseBody
            var responseBodyH5Text = "";
            if (data.responseBody != null) {
                var isJSON = false;
                var isXML = false;
                for (let i = 0; i < data.responseHeaders['Content-Type'].length; i++) {
                    if (data.responseHeaders['Content-Type'][i].includes('json')) {
                        isJSON = true;
                    } else if (data.responseHeaders['Content-Type'][i].includes('xml')) {
                        isXML = true;
                    }
                }
                if (isJSON) {
                    responseBodyH5Text = responseBodyH5Text + "<pre>" + formatJson(data.responseBody) + "</pre>";
                } else {
                    responseBodyH5Text = responseBodyH5Text + "<pre style='font-size: 17px'>" + data.responseBody + "</pre>";
                }
            }

            start = start + "  <div class='layui-colla-item'><h2 class='layui-colla-title'>Response Body</h2>" +
                "<div class='layui-colla-content'>" + responseBodyH5Text + "</div></div>";
            $('#consolePage').html(start + end);
            element.render('collapse');

            layer.open({
                type: 1,
                title: '测试结果',
                /*scrollbar: false,*/
                content: $('#consolePage'),
                area: ['600px', '500px'],
                btn: ['记录结果', '取消'],
                yes: function (index, doc) {
                    completeExecuteCallback(data.responseBody);
                    layer.close(index);
                }
            });
        }

        function formatJson(ugly) {
            try {
                // var obj = JSON.parse(ugly);
                return JSON.stringify(ugly, undefined, 4)
            } catch (e) {
                // layer.msg("JSON字符串错误，请检查")
                return ugly
            }
        }

        function getFormData(value) {
            var header = getHeaderKeyValueJsonArray();
            var requestFields = getRequestBodyKeyValueJsonArray();
            var responseFields = getResponseBodyKeyValueJsonArray();
            var uriFields = getUriVarJsonArray();

            var map = new Map();

            map['url'] = value["url"];
            map['name'] = value['name'];
            map['description'] = value['description'];
            map['resource'] = value['resource'];
            map['method'] = value["method"];
            map['headers'] = header;
            map['requestFields'] = requestFields;
            map['responseFields'] = responseFields;
            map['uriFields'] = uriFields;

            return map;
        }

        function getHeaderKeyValueJsonArray() {
            var headerKeyNodes = $('input[name=headerKey]');
            var headerValueNodes = $('input[name=headerValue]');
            /*var headerDescriptionNodes = $('textarea[name=headerDescription]');*/
            var headerConstraintNodes = $('input[name=headerConstraint]');

            var array = [];

            for (let i = 0; i < headerKeyNodes.length; i++) {
                var map = new Map();
                map["headerKey"] = headerKeyNodes[i].value;
                map["headerValue"] = headerValueNodes[i].value;
                /*map["headerDescription"] = easyeditor.content(headerDescriptionNodes[i].value);*/
                map["headerConstraint"] = (headerConstraintNodes[i].value === 'on');

                array[i] = map
            }
            return array
        }

        function getRequestBodyKeyValueJsonArray() {
            var requestFieldPathNodes = $('input[name=requestFieldPath]')
            var requestFieldValueNodes = $('input[name=requestFieldValue]')
            var requestFieldTypeNodes = $('select[name=requestFieldType]')
            /*var requestFieldDescriptionNodes = $('textarea[name=requestFieldDescription]')*/
            var requestFieldConstraintNodes = $('input[name=requestFieldConstraint]')
            var array = [];

            for (let i = 0; i < requestFieldPathNodes.length; i++) {
                var map = new Map();
                map["requestFieldPath"] = requestFieldPathNodes[i].value
                map["requestFieldValue"] = requestFieldValueNodes[i].value

                map["requestFieldType"] = requestFieldTypeNodes[i].value;
                map["requestFieldConstraint"] = (requestFieldConstraintNodes[i].value === 'on');

                array[i] = map
            }
            return array
        }

        function getUriVarJsonArray() {
            var uriFields = $('input[name=uriField]');
            var uriValueFields = $('input[name=uriValue]');
            var array = new Array();
            for (let i = 0; i < uriFields.length; i++) {
                var map = new Map();
                map['field'] = uriFields[i].value;
                map['value'] = uriValueFields[i].value;
                array[i] = map;
            }
            return array
        }

        function getResponseBodyKeyValueJsonArray() {
            var responseFieldPathNodes = $('input[name=responseFieldPath]');
            var responseFieldTypeNodes = $('select[name=responseFieldType]');
            /*var responseFieldDescriptionNodes = $('textarea[name=responseFieldDescription]');*/
            var responseFieldConstraintNodes = $('input[name=responseFieldConstraint]');
            var array = new Array();
            for (let i = 0; i < responseFieldPathNodes.length; i++) {
                var map = new Map()
                map["responseFieldPath"] = responseFieldPathNodes[i].value;
                map["responseFieldType"] = responseFieldTypeNodes[i].value;
                map["responseFieldConstraint"] = (responseFieldConstraintNodes[i].value === 'on')
                array[i] = map
            }
            return array
        }

        var document = [[${initDocument}]];

        if (document !== null) {
            initTestApiDoc(document, form, oneuriline, oneheaderline, oneline, responseoneline);
            element.render('collapse');
        }
    });

    function deleteResponseBodyBtn(obj) {
        var parent = obj.parentNode.parentNode.parentNode;
        var children = obj.parentNode.parentNode;
        parent.removeChild(children);
    }

    function deleteRequestBodyBtn(obj) {
        var parent = obj.parentNode.parentNode.parentNode;
        var children = obj.parentNode.parentNode;
        parent.removeChild(children);
    }

    function deleteHeaderFieldLine(obj) {
        var parent = obj.parentNode.parentNode.parentNode;
        var children = obj.parentNode.parentNode;
        parent.removeChild(children)
    }

    function deleteUriVarFieldLine(obj) {
        var parent = obj.parentNode.parentNode.parentNode;
        var children = obj.parentNode.parentNode;
        parent.removeChild(children);
    }
</script>
</body>
</html>