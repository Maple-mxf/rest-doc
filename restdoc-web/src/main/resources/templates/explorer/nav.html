<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>文档中心</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/pearForm.css}"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/admin/css/fangge-style.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/doc-common.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/nav.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/pear-tree/dtree.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/pear-tree/font/dtreefont.css}"/>
</head>
<body>
<div class="layui-row" style="width: 100%">
    <ul class="layui-nav layui-bg-green" id="navigation" lay-filter="test">
        <li class="layui-nav-item">
            <a href="/restdoc/project/view"> <i class="layui-icon layui-icon-return"
                                                style="font-size: 17px;  color: white;"></i>&nbsp;</a>
        </li>
        <li class="layui-nav-item layui-this"><a id="home" th:href="@{'/'+${projectId}+'/document/nav/view'}">文档</a>
        </li>
        <li class="layui-nav-item"><a id="projectDetail" href="javascript:;">项目详情</a></li>
        <li class="layui-nav-item"><a id="clientServiceList" href="javascript:;">服务实例<span class="layui-badge"
                                                                                           th:text="${instanceNumber}"></span></a>
        </li>
        <li class="layui-nav-item"><a id="tableContentManage" href="javascript:;">目录管理</a></li>
        <li class="layui-nav-item"><a id="createAPI" href="javascript:;">创建API</a>
        <li class="layui-nav-item"><a id="createWIKI" href="javascript:;">创建WIKI</a>
        </li>
    </ul>
</div>

<input type="hidden" id="projectId" th:value="${projectId}">

<div class="layui-fluid">
    <iframe src="" id="docContentFrame" frameborder="0" style="width: 100%;height: 1000px;">
    </iframe>
</div>
<script th:src="@{/layui/layui.js}"></script>
<script th:src="@{/admin/js/jquery.js}"></script>
<script th:src="@{/admin/js/util.js}"></script>

<script>

    layui.config({
        base: '/restdoc/layui/lay/extends/'
    }).use([
        'util',
        'layer',
        'element',
        'jquery',
        'tree' ], function () {
        var tree = layui.tree;
        var $ = layui.jquery;
        var layer = layui.layer;
        var element = layui.element;
        var treeData = null;
        var projectId = $("#projectId").val();

        // /restdoc/project/746946688983240704/navigation/view
        $("#docContentFrame").attr("src", "/restdoc/project/" + projectId + "/navigation/view");

        element.on('nav(test)', function (elem) {
            if ('clientServiceList' === elem[0].id) {
                layer.closeAll();
                $("#docContentFrame").attr("src", '/restdoc/microservice/view/list?ap=REST_WEB&projectId=' + projectId);
            } else if ('projectDetail' === elem[0].id) {
                layer.closeAll();
                $("#docContentFrame").attr("src", '/restdoc/project/' + projectId + '/view');
            } else if ('tableContentManage' === elem[0].id) {
                layer.closeAll();
                $("#docContentFrame").attr("src", '/restdoc/' + projectId + '/resource/view/table');
            } else if ('createAPI' === elem[0].id) {
                layer.closeAll();
                $("#docContentFrame").attr("src", '/restdoc/' + projectId + '/document/view/api/add');
            } else if ('createWIKI' === elem[0].id) {
                layer.closeAll();
                $("#docContentFrame").attr("src", '/restdoc/' + projectId + '/document/view/wiki/add');
            }
        });

      /*  var docId = getFirstDocument(treeData);
        if (null != docId) {
            $("#docContentFrame").attr("src", '/restdoc/' + projectId + '/document/' + docId + '/view');
        }

        $.ajax({
            type: 'GET',
            url: '/restdoc/' + projectId + '/resource/tree',
            async: false,
            success: function (data) {
                if (data['code'] === "200") {
                    treeData = data['data'];
                    var docId = getFirstDocument(treeData);
                    if (null != docId) {
                        $("#docContentFrame").attr("src", '/restdoc/' + projectId + '/document/' + docId + '/view');
                    }
                } else {
                    layer.msg(data['message']);
                }
            },
            error: function () {
                layer.msg("网络异常")
            }
        });*/
    });

    $('#restweb-project-nav').addClass("layui-this");


</script>
</body>
</html>