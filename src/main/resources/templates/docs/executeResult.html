<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>富文本编辑器</title>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/pearForm.css}"/>
    <link type="text/css" rel="stylesheet" th:href="@{/admin/css/doc-font.css}"/>
    <style>
        body {
            margin: 10px;
            background-color: #0C0C0C;
            color: whitesmoke;
            /*    font-family: "Consolas", serif;
                font-size: 17px;*/

            font-size: 14px;
        }
    </style>
</head>
<body>


<input type="hidden" id="taskId" th:value="${taskId}">

<p style="color: white" id="content">
</p>

<script th:src="@{/layui/layui.js}"></script>
<script th:src="@{/admin/js/jquery.js}"></script>
<script th:src="@{/admin/js/util.js}"></script>
<script type="text/javascript" th:inline="javascript">
    //注意：折叠面板 依赖 element 模块，否则无法进行功能性操作
    layui.use('element', function () {
        var element = layui.element;

        //…
    });

    var taskId = $('#taskId').val().toString();

    for (let i = 0; i < 100; i++) {
        var data = getExecuteResult()

        //JSON.stringify(map)
        if (data['code'] === "200") {
            $("#content").append("url : " + data['data']['url'] + '<br/>')
            $("#content").append("status code : " + data['data']['status'] + '<br/>')
            $("#content").append("request header : <br/>" + formatJson(data['data']['requestHeader']) + '<br/><br/>')
            $("#content").append("response header : <br/>" + formatJson(data['data']['responseHeader']) + '<br/><br/>')
            $("#content").append("response body : <br/>" + formatJson(data['data']['content']) + '<br/><br/>')
            break;
        } else {
            console.info(data)
        }
    }

    function getExecuteResult() {
        var result = null;

        $.ajax({
            type: 'GET',
            contentType: 'application/json;charset=utf-8',
            url: '/restdoc/document/httpTask/' + taskId,
            async: false,
            success: function (data) {
                result = data;
            }
        });

        return result;
    }


    function formatJson(ugly) {
        try {
            // var obj = JSON.parse(ugly);
            var pretty = JSON.stringify(ugly, undefined, 4);
            console.info(pretty)
          return pretty
        } catch (e) {
            // layer.msg("JSON字符串错误，请检查")
            return ugly
        }
    }


</script>
</body>
</html>